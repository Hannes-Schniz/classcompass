{% extends "base.html" %} {% block title %}Edit Credentials{% endblock %} {%
block content %}
<div class="page-header">
  <h1>Edit credentials.json</h1>
  <p>Update your Google API credentials securely.</p>
</div>

<div class="alert alert-info">
  <strong>‚ö†Ô∏è Security Notice:</strong> This page contains sensitive information
  like private keys and client secrets. Make sure you're in a secure
  environment.
</div>

<form method="POST" id="credentialsForm">
  <div
    class="card"
    style="margin: 1rem 0; border: 1px solid var(--border-color)">
    <div class="card-header" style="background: var(--success-color)">
      üîë Google Service Account Credentials
    </div>
    <div class="card-body">
      <div class="grid grid-2">
        <div class="form-group">
          <label for="type">Type:</label>
          <input
            type="text"
            id="type"
            name="type"
            class="form-control"
            value="{{ creds.type }}"
            required />
          <div class="help-text">Usually "service_account"</div>
        </div>
        <div class="form-group">
          <label for="project_id">Project ID:</label>
          <input
            type="text"
            id="project_id"
            name="project_id"
            class="form-control"
            value="{{ creds.project_id }}"
            required />
          <div class="help-text">Google Cloud project identifier</div>
        </div>
        <div class="form-group">
          <label for="private_key_id">Private Key ID:</label>
          <input
            type="text"
            id="private_key_id"
            name="private_key_id"
            class="form-control"
            value="{{ creds.private_key_id }}"
            required />
          <div class="help-text">Unique key ID for the service account</div>
        </div>
        <div class="form-group">
          <label for="private_key">Private Key:</label>
          <textarea
            id="private_key"
            name="private_key"
            class="form-control"
            rows="4"
            required>
{{ creds.private_key }}</textarea
          >
          <div class="help-text">
            Paste the full private key here (starts with -----BEGIN PRIVATE
            KEY-----)
          </div>
        </div>
        <div class="form-group">
          <label for="client_email">Client Email:</label>
          <input
            type="email"
            id="client_email"
            name="client_email"
            class="form-control"
            value="{{ creds.client_email }}"
            required />
          <div class="help-text">Service account email address</div>
        </div>
        <div class="form-group">
          <label for="client_id">Client ID:</label>
          <input
            type="text"
            id="client_id"
            name="client_id"
            class="form-control"
            value="{{ creds.client_id }}"
            required />
          <div class="help-text">Google client ID for the service account</div>
        </div>
        <div class="form-group">
          <label for="auth_uri">Auth URI:</label>
          <input
            type="text"
            id="auth_uri"
            name="auth_uri"
            class="form-control"
            value="{{ creds.auth_uri }}"
            required />
          <div class="help-text">
            Usually https://accounts.google.com/o/oauth2/auth
          </div>
        </div>
        <div class="form-group">
          <label for="token_uri">Token URI:</label>
          <input
            type="text"
            id="token_uri"
            name="token_uri"
            class="form-control"
            value="{{ creds.token_uri }}"
            required />
          <div class="help-text">
            Usually https://oauth2.googleapis.com/token
          </div>
        </div>
        <div class="form-group">
          <label for="auth_provider_x509_cert_url"
            >Auth Provider x509 Cert URL:</label
          >
          <input
            type="text"
            id="auth_provider_x509_cert_url"
            name="auth_provider_x509_cert_url"
            class="form-control"
            value="{{ creds.auth_provider_x509_cert_url }}"
            required />
          <div class="help-text">
            Usually https://www.googleapis.com/oauth2/v1/certs
          </div>
        </div>
        <div class="form-group">
          <label for="client_x509_cert_url">Client x509 Cert URL:</label>
          <input
            type="text"
            id="client_x509_cert_url"
            name="client_x509_cert_url"
            class="form-control"
            value="{{ creds.client_x509_cert_url }}"
            required />
          <div class="help-text">Service account certificate URL</div>
        </div>
        <div class="form-group">
          <label for="universe_domain">Universe Domain:</label>
          <input
            type="text"
            id="universe_domain"
            name="universe_domain"
            class="form-control"
            value="{{ creds.universe_domain }}"
            required />
          <div class="help-text">Google universe domain (optional)</div>
        </div>
      </div>
    </div>
  </div>
  <div style="text-align: center; margin-top: 2rem">
    <button type="submit" class="btn btn-primary">üíæ Save Credentials</button>
    <a href="/" class="btn btn-secondary">Cancel</a>
    <button type="button" id="previewBtn" class="btn btn-info">
      üëÅÔ∏è Preview JSON
    </button>
  </div>
</form>

<div
  id="jsonPreview"
  class="json-preview"
  style="display: none; margin-top: 2rem">
  <strong>JSON Preview:</strong>
  <pre id="jsonContent">{{ creds | tojson(indent=2) }}</pre>
</div>

{% endblock %} {% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const previewBtn = document.getElementById('previewBtn');
    const jsonPreview = document.getElementById('jsonPreview');
    const jsonContent = document.getElementById('jsonContent');
    function getFormData() {
      return {
        type: document.getElementById('type').value,
        project_id: document.getElementById('project_id').value,
        private_key_id: document.getElementById('private_key_id').value,
        private_key: document.getElementById('private_key').value,
        client_email: document.getElementById('client_email').value,
        client_id: document.getElementById('client_id').value,
        auth_uri: document.getElementById('auth_uri').value,
        token_uri: document.getElementById('token_uri').value,
        auth_provider_x509_cert_url: document.getElementById(
          'auth_provider_x509_cert_url'
        ).value,
        client_x509_cert_url: document.getElementById('client_x509_cert_url')
          .value,
        universe_domain: document.getElementById('universe_domain').value,
      };
    }
    previewBtn.addEventListener('click', function () {
      const creds = getFormData();
      jsonContent.textContent = JSON.stringify(creds, null, 2);
      if (jsonPreview.style.display === 'none') {
        jsonPreview.style.display = 'block';
        previewBtn.textContent = '‚ùå Hide JSON';
      } else {
        jsonPreview.style.display = 'none';
        previewBtn.textContent = 'üëÅÔ∏è Preview JSON';
      }
    });
  });
</script>
{% endblock %}
